name: AutoDev

on:
  issues:
    types: [labeled]
  issue_comment:
    types: [created]

concurrency:
  group: autodev-${{ github.event.issue.number }}
  cancel-in-progress: true

jobs:
  call-autodev:
    if: |
      (github.event_name == 'issues' && github.event.label.name == 'automagic') ||
      (github.event_name == 'issue_comment' && github.event.issue.pull_request && startsWith(github.event.comment.body, '/autofix'))
    uses: Kuinka-agency/dev-factory/.github/workflows/autodev-reusable.yml@main
    with:
      issue_number: ${{ github.event.issue.number }}
      issue_title: ${{ github.event.issue.title || '' }}
      issue_body: ${{ github.event.issue.body || '' }}
      event_name: ${{ github.event_name }}
      comment_body: ${{ github.event.comment.body || '' }}
      pr_number: ${{ github.event.issue.number }}
    secrets:
      GH_PAT: ${{ secrets.GH_PAT }}
